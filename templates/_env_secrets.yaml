{{/*
Output the environment secret block for mastodon
*/}}
{{- define "mastodon.env_secrets" -}}
- name: OTP_SECRET
  valueFrom:
    secretKeyRef:
      name: {{ template "fullname" . }}-mastodon-secrets
      key: OTP_SECRET
- name: SECRET_KEY_BASE
  valueFrom:
    secretKeyRef:
      name: {{ template "fullname" . }}-mastodon-secrets
      key: SECRET_KEY_BASE
- name: PAPERCLIP_SECRET
  valueFrom:
    secretKeyRef:
      name: {{ template "fullname" . }}-mastodon-secrets
      key: PAPERCLIP_SECRET
{{- end }}

{{/*
Output the environment variables for service discovery.
*/}}
{{- define "mastodon.env_discovery" -}}
- name: REDIS_HOST
  value: {{ template "fullname" . }}-redis
- name: REDIS_PORT
  value: {{ .Values.redisPort | quote }}
- name: DB_HOST
  value: {{ template "fullname" . }}-postgres
- name: DB_PORT
  value: {{ .Values.dbPort | quote }}
{{- end }}
